<html lang="en">

<head>
    <meta charset="UTF-8">

    <link href="{pathCss}/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="{pathCss}/fontawesome.css" rel="stylesheet" crossorigin="anonymous">
    <link href="{pathCss}/simpleXML.css" rel="stylesheet" crossorigin="anonymous">
    <link href="{pathCss}/custom.css" rel="stylesheet" crossorigin="anonymous">
    <link href="{pathCss}/jsonview.css" rel="stylesheet" crossorigin="anonymous">

    <script src="{pathJS}/jquery-3.4.1.js"></script>
    <script src="{pathJS}/popper.js"></script>
    <script src="{pathJS}/fontawesome.js"></script>
    <script src="{pathJS}/jsplumb.min.js"></script>
    <script src="{pathJS}/simpleXML.js"></script>
    <script src="{pathJS}/jsonview.js"></script>


    <title>Diagram</title>
    <style>

    </style>

</head>

<body class="body">
<div class="container">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <p id="a"></p>
            <div class="block">
                <div id="start" class="card item_start">
                    <div class="text-center" style="padding: 15px">
                        <div class="text-center">
                            <b>Start </b>
                        </div>
                        <div class="text-center" id="start-req-btn">
                            <hr>
                            <button disabled id="req-btn" class="btn btn-secondary btn-xs ">Request</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="block">
                <div id="item_1" class="text-center card-body item">
                    <div><b>Inbound Authentication Config</b></div>

                </div>
            </div>

            <div class="block" id="item_input">
                <div id="stop" class="card item_start">
                    <div class="text-center" style="padding: 15px">
                        <div class="text-center" id="end-res-btn">
                            <button disabled id="res-btn" class="btn btn-secondary btn-xs ">Response</button>
                            <hr>
                        </div>
                        <div class="text-center">
                            <b>End</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="commmon-modal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-title">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="modal-body" class="pre-scrollable modal-body">
                <div id="simpleUseCase"></div>
                <div class="root"></div>

                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" id="res-tab-menu">
                        <a class="nav-link active" id="res-tab" style="" data-toggle="tab" href="#res-tab-val"
                           role="tab"
                           aria-controls="home"
                           aria-selected="true">Response</a>
                    </li>
                    <li class="nav-item" id="req-tab-menu">
                        <a class="nav-link" id="req-tab" data-toggle="tab" href="#req-tab-val" role="tab"
                           aria-controls="profile"
                           aria-selected="false">Request</a>
                    </li>
                </ul>

                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active pre-scrollable" id="res-tab-val" role="tabpanel"
                         aria-labelledby="home-tab"></div>
                    <div class="tab-pane fade pre-scrollable" id="req-tab-val" role="tabpanel"
                         aria-labelledby="profile-tab"></div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="{pathJS}/bootstrap.min.js"></script>
<script src="{pathJS}/custom.js"></script>
<script>
    $(document).ready(function () {
        const vscode = acquireVsCodeApi();
        var filepath = '{myfilepath}';
        var text = `{myXML}`;
        xmlDoc = $.parseXML(text);
        $xml = $(xmlDoc);
        x = document.getElementById("item_1");
        y = document.getElementById("item_input");
        var samlRequest = `{SAML_REQUEST}`;
        var samlResponse = `{SAML_RESPONSE}`;
        var oidcAuthzRequest = `{OIDC_AUTHZ_REQUEST}`;
        var oidcAuthzResponse = `{OIDC_AUTHZ_RESPONSE}`;
        var oidcTokenRequest = `{OIDC_TOKEN_REQUEST}`;
        var oidcTokenResponse = `{OIDC_TOKEN_RESPONSE}`;

        $xml.find("InboundAuthenticationConfig").find("InboundAuthenticationRequestConfigs").find("InboundAuthenticationRequestConfig").each(function () {

            var $row = $(this),
                name = $row.find("column1").text(),
                job = $row.find("InboundAuthType").text();

            if (job == "samlsso") {
                x.innerHTML += `<div class="card" id="samlsso-card" style="margin: 20px">
                           <div class="text-center card-header-pills">
                               <div><b>` + job + `</b></div>
                            </div>
                        </div>`;

                addConfig(samlRequest, samlResponse);
            } else if (job == "openid") {
                x.innerHTML += `<div class="card"  style="margin: 20px" id="oidc-card">
                      <div class="card"  id="oidc-label">
                        <b>` + job + `</b>
                      </div>
                        <div class="card-body" style="padding: 10px">
                            <div class="card" style="margin-bottom: 5px; padding: 10px">
                                    <div class="text-center"><h6>Authz Endpoint</h6></div>

                                <div style="padding-bottom: 10px"><button disabled id="authz-req-btn" class="btn btn-secondary btn-xs ">Request</button></div>
                                <div><button disabled id="authz-res-btn" class="btn btn-secondary btn-xs ">Response</button></div>
                            </div>
                            <div class="card" style="padding: 10px">
                             <div class="text-center"><h6>Token Endpoint</h6></div>
                                <div style="padding-bottom: 10px"><button disabled id="token-req-btn" class="btn btn-secondary btn-xs ">Request</button></div>
                                <div><button disabled id="token-res-btn" class="btn btn-secondary btn-xs ">Response</button></div>
                            </div>
                        </div>
                        </div>`;
                addOIDCConfig(oidcAuthzRequest, oidcAuthzResponse, oidcTokenRequest, oidcTokenResponse);
                $('#start-req-btn').hide();
                $('#end-res-btn').hide();
            } else {
                x.innerHTML += `<div class="card" style="margin: 20px">
                           <div class="text-center card-header-pills">
                               <div><b>` + job + `</b></div>
                            </div>
                        </div>`;
            }


        });

        var executeStep = 0;
        $xml.find("LocalAndOutBoundAuthenticationConfig").find("AuthenticationSteps").find("AuthenticationStep").each(function () {
            executeStep += 1;
            var $row = $(this),
                name = $row.find("column1").text(),
                job = $row.find("LocalAuthenticatorConfigs").find("Name").text();
            y.innerHTML += `                        <div class="card" style="margin: 20px">
                           <div class="text-center card-header-pills">
                               <div><b>` + job + `</b></div>
                            </div>
                        </div>`;
        });

        var code = $xml.find("LocalAndOutBoundAuthenticationConfig").find("AuthenticationScript").text();
        if (samlRequest.includes("SAML_REQUEST") && oidcAuthzRequest.includes("OIDC_AUTHZ_REQUEST")) {
            if (code.length > 0) {
                vscode.postMessage({
                    command: 'scriptFile'
                })
            } else {
                vscode.postMessage({
                    command: 'defaultScriptFile',
                    data: executeStep
                })
            }
        }

        jsPlumb.ready(function () {
                /*First Instance*/
                var zeroInstance = jsPlumb.getInstance();

                zeroInstance.importDefaults({
                        ConnectionsDetachable: false,
                        Connector: ["Straight", {
                            curviness: 150
                        }

                        ],
                        Anchors: ["BottomCenter", "TopCenter"]
                    }
                );

                zeroInstance.connect({
                        ConnectionsDetachable: false,
                        source: "start",
                        target: "item_1",
                        scope: "someScope"
                    }
                );

                var firstInstance = jsPlumb.getInstance();

                firstInstance.importDefaults({
                        ConnectionsDetachable: false,
                        Connector: ["Straight", {
                            curviness: 20,
                            stub: 12
                        }

                        ],
                        Anchors: ["BottomCenter", "TopCenter"]
                    }
                );


                firstInstance.connect({
                        source: "item_1",
                        target: "stop",
                        scope: "someScope"
                    }
                );
            }
        );

    });
</script>

</html>
